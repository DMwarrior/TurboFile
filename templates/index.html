<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊûÅÈÄü‰º† - È´òÈÄüÊñá‰ª∂‰º†ËæìÁ≥ªÁªü</title>

    <!-- Favicon - lightning icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path fill='%23ffc107' d='M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z'/></svg>" type="image/svg+xml">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
    <div class="container-fluid" style="position: relative;">


        <!-- Header area -->
        <div class="row flex-shrink-0" style="margin-bottom: 2px;">
            <div class="col-12">
                <div class="d-flex align-items-center justify-content-center">
                    <!-- Product title group -->
                    <div class="product-brand d-flex align-items-center">
                        <h4 class="main-title d-flex align-items-center" style="margin: 0; line-height: 1;">
                            <i class="bi bi-lightning-charge-fill" style="color: #ffc107; font-size: 1.0em; margin-right: 6px;"></i>
                            <span>ÊûÅÈÄü‰º†</span>
                        </h4>
                    </div>
                </div>
            </div>
        </div>

        <!-- Server selection panel -->
        <div class="row g-1 flex-shrink-0" style="margin-bottom: 3px;">
            <div class="col-md-6">
                <div class="server-panel" style="padding: 4px 6px;">
                    <h6 style="font-size: 0.85rem; margin-bottom: 2px;">
                        <i class="bi bi-hdd-network-fill text-primary"></i> Â∑¶‰æßÊúçÂä°Âô®
                    </h6>
                    <select id="sourceServer" class="form-select" style="font-size: 0.85rem;">
                        <option value="" disabled selected hidden>üîç ËØ∑ÈÄâÊã©Ê∫êÊúçÂä°Âô®</option>
                        {% for ip, info in servers.items() %}
                        {% if info.get('os_type') != 'windows' or is_admin_client or (client_ipv4 and ip == client_ipv4) %}
                        <option value="{{ ip }}">üñ•Ô∏è {{ info.name }} ({{ ip }})</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="server-panel" style="padding: 4px 6px;">
                    <h6 style="font-size: 0.85rem; margin-bottom: 2px;">
                        <i class="bi bi-cloud-upload-fill text-success"></i> Âè≥‰æßÊúçÂä°Âô®
                    </h6>
                    <select id="targetServer" class="form-select" style="font-size: 0.85rem;">
                        <option value="" disabled selected hidden>üéØ ËØ∑ÈÄâÊã©ÊúçÂä°Âô®</option>
                        {% for ip, info in servers.items() %}
                        {% if info.get('os_type') != 'windows' or is_admin_client or (client_ipv4 and ip == client_ipv4) %}
                        <option value="{{ ip }}">üñ•Ô∏è {{ info.name }} ({{ ip }})</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- File browser -->
        <div class="row flex-grow-1" style="min-height: 0;">
            <div class="resizable-container" style="height: 100%;">
                <div class="resizable-panel" id="sourcePanel" style="width: 50%; height: 100%;">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <h6 style="font-size: 0.9rem; margin-bottom: 0;">
                            <i class="bi bi-files text-info"></i> Â∑¶‰æßÊñá‰ª∂ÊµèËßà
                        </h6>
                        <div class="d-flex align-items-center" style="gap: 10px;">
                            <small id="sourceFileCount" style="font-size: 0.75rem; color: #64748b;">ÂÖ± 0 È°π</small>
                            <small id="sourceSelectedInfo" style="font-size: 0.75rem; color: #0d6efd; display: none;"></small>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshSource()" title="Âà∑Êñ∞ÁõÆÂΩïÂÜÖÂÆπ" style="font-size: 0.75rem; padding: 2px 6px;">
                                <i class="bi bi-arrow-clockwise"></i> Âà∑Êñ∞
                            </button>
                            <div class="form-check form-switch" style="font-size: 0.75rem;">
                                <input class="form-check-input" type="checkbox" id="sourceShowHidden" onchange="toggleHiddenFiles('source')">
                                <label class="form-check-label" for="sourceShowHidden" style="font-size: 0.75rem;">
                                    ÊòæÁ§∫ÈöêËóèÊñá‰ª∂
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="sourcePathNav" class="path-nav" style="display: none; padding: 3px 8px; font-size: 0.8rem;" onclick="maybeStartPathInlineEdit(event, true)">
                        <div class="path-left">
                            <i class="bi bi-geo-alt-fill text-primary me-1"></i>
                            <span id="sourcePathDisplay" class="path-display">/</span>
                        </div>
                        <div class="path-actions">
                            <button type="button" class="btn btn-sm" title="Êü•ÊâæÊñá‰ª∂/Êñá‰ª∂Â§π"
                                    onclick="quickLocateInPanel(true, event)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-search text-primary" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Âà†Èô§ÈÄâ‰∏≠È°π"
                                    onclick="deleteSelected('source', event)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-trash text-danger" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Â§çÂà∂ÂΩìÂâçË∑ØÂæÑ"
                                    onclick="copyPath('source')"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-files text-secondary" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Â±ïÂºÄÂõæÁâá"
                                    onclick="openImageGrid(true)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-grid-3x3-gap text-info" style="font-size: 0.9rem;"></i>
                            </button>
                        </div>
                    </div>
                    <div id="sourceFileBrowser" class="file-browser" style="height: calc(100% - 50px); padding-bottom: 10px;">
                        <div class="text-center text-muted p-3">
                            <i class="bi bi-server fs-3 mb-2 d-block opacity-50"></i>
                            <p class="mb-0" style="font-size: 0.85rem;">ËØ∑ÂÖàÈÄâÊã©ÊúçÂä°Âô®</p>
                        </div>
                    </div>
                </div>

                <div class="resizer" id="verticalResizer"></div>

                <div class="resizable-panel" id="targetPanel" style="width: 50%; height: 100%;">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <h6 style="font-size: 0.9rem; margin-bottom: 0;">
                            <i class="bi bi-folder-check text-success"></i> Âè≥‰æßÊñá‰ª∂ÊµèËßà
                        </h6>
                        <div class="d-flex align-items-center" style="gap: 10px;">
                            <small id="targetFileCount" style="font-size: 0.75rem; color: #64748b;">ÂÖ± 0 È°π</small>
                            <small id="targetSelectedInfo" style="font-size: 0.75rem; color: #198754; display: none;"></small>
                            <button class="btn btn-outline-success btn-sm" onclick="refreshTarget()" title="Âà∑Êñ∞ÁõÆÂΩïÂÜÖÂÆπ" style="font-size: 0.75rem; padding: 2px 6px;">
                                <i class="bi bi-arrow-clockwise"></i> Âà∑Êñ∞
                            </button>
                            <div class="form-check form-switch" style="font-size: 0.75rem;">
                                <input class="form-check-input" type="checkbox" id="targetShowHidden" onchange="toggleHiddenFiles('target')">
                                <label class="form-check-label" for="targetShowHidden" style="font-size: 0.75rem;">
                                    ÊòæÁ§∫ÈöêËóèÊñá‰ª∂
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="targetPathNav" class="path-nav" style="display: none; padding: 3px 8px; font-size: 0.8rem;" onclick="maybeStartPathInlineEdit(event, false)">
                        <div class="path-left">
                            <i class="bi bi-geo-alt-fill text-success me-1"></i>
                            <span id="targetPathDisplay" class="path-display">/</span>
                        </div>
                        <div class="path-actions">
                            <button type="button" class="btn btn-sm" title="Êü•ÊâæÊñá‰ª∂/Êñá‰ª∂Â§π"
                                    onclick="quickLocateInPanel(false, event)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-search text-success" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Âà†Èô§ÈÄâ‰∏≠È°π"
                                    onclick="deleteSelected('target', event)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-trash text-danger" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Â§çÂà∂ÂΩìÂâçË∑ØÂæÑ"
                                    onclick="copyPath('target')"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-files text-secondary" style="font-size: 0.85rem;"></i>
                            </button>
                            <button type="button" class="btn btn-sm" title="Â±ïÂºÄÂõæÁâá"
                                    onclick="openImageGrid(false)"
                                    style="padding:0 4px; background: transparent; border: none; border-radius:4px;">
                                <i class="bi bi-grid-3x3-gap text-success" style="font-size: 0.9rem;"></i>
                            </button>
                        </div>
                    </div>
                    <div id="targetFileBrowser" class="file-browser" style="height: calc(100% - 50px); padding-bottom: 10px;">
                        <div class="text-center text-muted p-3">
                            <i class="bi bi-cloud-upload fs-3 mb-2 d-block opacity-50"></i>
                            <p class="mb-0" style="font-size: 0.85rem;">ËØ∑ÂÖàÈÄâÊã©ÁõÆÊ†áÊúçÂä°Âô®</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfer control panel -->
        <div class="row flex-shrink-0">
            <div class="col-12">
                <div class="card">
                    <div class="card-body" style="padding: 8px 12px;">
                        <div class="text-center" style="display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap;">
                            <!-- Transfer mode selector (separated styles) -->
                            <input type="radio" class="btn-check" name="transferMode" id="modeCopy" value="copy" checked>
                            <label class="btn btn-outline-primary transfer-mode-btn" for="modeCopy">
                                <i class="bi bi-files"></i> Â§çÂà∂
                            </label>

                            <input type="radio" class="btn-check" name="transferMode" id="modeMove" value="move">
                            <label class="btn btn-outline-primary transfer-mode-btn" for="modeMove">
                                <i class="bi bi-scissors"></i> Ââ™Âàá
                            </label>

                            <!-- Start transfer button -->
                            <button id="startTransferBtn" class="btn btn-primary me-2" onclick="startTransfer()" style="padding: 6px 16px;">
                                <i class="bi bi-lightning-charge-fill"></i> ÂºÄÂßã‰º†Ëæì
                            </button>

                            <!-- Cancel transfer button -->
                            <button id="cancelTransferBtn" class="btn btn-danger me-2" onclick="cancelTransfer()" ondblclick="forceCancelTransfer()" style="display: none; padding: 6px 16px;" title="ÂçïÂáªÂèñÊ∂à‰º†ËæìÔºåÂèåÂáªÂº∫Âà∂ÁªàÊ≠¢">
                                <i class="bi bi-stop-circle-fill"></i> ÂèñÊ∂à‰º†Ëæì
                            </button>

                            <!-- View logs button -->
                            <button class="btn btn-primary" onclick="showLogModal()" style="padding: 6px 12px;" title="Êü•Áúã‰º†ËæìÊó•Âøó">
                                <i class="bi bi-journal-text"></i> Êü•ÁúãÊó•Âøó
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress display -->
        <div class="row flex-shrink-0">
            <div class="col-12">
                <div id="progressContainer" class="progress-container">
                    <div class="card">
                        <div class="card-body">
                            <!-- Transfer path display -->
                            <div class="transfer-route mb-2 p-2 bg-light rounded" style="height: 40px; display: flex; align-items: center; justify-content: center;">
                                <div id="transferRoute" class="fw-bold text-primary" style="font-size: 14px;">
                                    <i class="bi bi-arrow-right-circle-fill me-1"></i>
                                    ÂáÜÂ§á‰º†Ëæì...
                                </div>
                            </div>
                            {% set progress_col_class = 'col-6 col-md-3' if transfer_bytes_enabled else 'col-6 col-md-4' %}
                            <div class="row g-2">
                                <div class="{{ progress_col_class }}">
                                    <div class="d-flex align-items-center stat-item">
                                        <i class="bi bi-speedometer text-info me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">ÈÄüÂ∫¶</small>
                                            <div id="transferSpeed" class="fw-bold" style="font-size: 0.85rem;">-</div>
                                        </div>
                                    </div>
                                </div>
                                {% if transfer_bytes_enabled %}
                                <div class="{{ progress_col_class }}">
                                    <div class="d-flex align-items-center stat-item">
                                        <i class="bi bi-download text-success me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">Â∑≤‰º†Ëæì</small>
                                            <div id="transferredBytes" class="fw-bold" style="font-size: 0.85rem;">-</div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="{{ progress_col_class }}">
                                    <div class="d-flex align-items-center stat-item">
                                        <i class="bi bi-clock text-warning me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">Â∑≤Áî®Êó∂Èó¥</small>
                                            <div id="elapsedTime" class="fw-bold" style="font-size: 0.85rem;">00:00:00</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="{{ progress_col_class }}">
                                    <div class="d-flex align-items-center stat-item">
                                        <i class="bi bi-info-circle text-primary me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">Áä∂ÊÄÅ</small>
                                            <div id="transferStatus" class="fw-bold" style="font-size: 0.85rem;">ÂáÜÂ§á‰∏≠</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>




    </div>
    <div id="toastContainer" class="toast-container" aria-live="polite"></div>

    <!-- File area context menu -->
    <div id="fileContextMenu" class="file-context-menu">
        <div class="menu-item" data-action="rename">
            <i class="bi bi-pencil-square text-warning"></i>
            <span>ÈáçÂëΩÂêç</span>
        </div>
        <div class="menu-item" data-action="new-folder">
            <i class="bi bi-folder-plus text-success"></i>
            <span>Êñ∞Âª∫Êñá‰ª∂Â§π</span>
        </div>
        <div class="menu-item" data-action="new-file">
            <i class="bi bi-file-earmark-plus text-primary"></i>
            <span>Êñ∞Âª∫Êñá‰ª∂</span>
        </div>
        <div class="menu-item" data-action="run">
            <i class="bi bi-play-fill text-primary"></i>
            <span>ËøêË°å</span>
        </div>
        <div class="menu-item" data-action="compare">
            <i class="bi bi-shuffle text-info"></i>
            <span>ÂØπÊØî</span>
        </div>
        <div class="menu-item" data-action="size">
            <i class="bi bi-hdd-network text-info"></i>
            <span>ËÆ°ÁÆóÂ§ßÂ∞è</span>
        </div>
        <div class="menu-item" data-action="compress">
            <i class="bi bi-archive text-primary"></i>
            <span>ÂéãÁº©</span>
        </div>
        <div class="menu-item" data-action="extract">
            <i class="bi bi-box-arrow-down text-success"></i>
            <span>Ëß£Âéã</span>
        </div>
        <div class="menu-item" data-action="download-windows">
            <i class="bi bi-windows text-primary"></i>
            <span>‰∏ãËΩΩÂà∞Windows</span>
        </div>
    </div>

    

    <!-- Download to Windows: choose target directory -->
    <div class="modal" id="downloadWindowsModal" tabindex="-1" aria-labelledby="downloadWindowsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable download-win-dialog">
            <div class="modal-content download-win-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="downloadWindowsModalLabel">
                        <i class="bi bi-windows text-primary"></i> ‰∏ãËΩΩÂà∞Windows
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center gap-2 mb-2 download-win-drive-row">
                        <label class="form-label mb-0" for="downloadWindowsDriveSelect">Á£ÅÁõò</label>
                        <select id="downloadWindowsDriveSelect" class="form-select form-select-sm download-win-drive"></select>
                    </div>
                    <div class="input-group input-group-sm">
                        <input id="downloadWindowsPathInput" type="text" class="form-control" placeholder="ËæìÂÖ•Ë∑ØÂæÑ">
                        <button class="btn btn-outline-secondary" type="button" onclick="downloadWinPickerNavigateToInput()">Ë∑≥ËΩ¨</button>
                        <button class="btn btn-outline-secondary" type="button" onclick="downloadWinPickerGoUp()">‰∏ä‰∏ÄÁ∫ß</button>
                        <button class="btn btn-outline-secondary" type="button" onclick="downloadWinPickerRefresh()">Âà∑Êñ∞</button>
                    </div>

                    <div id="downloadWindowsDirList" class="list-group download-win-list"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" onclick="confirmDownloadToWindows()">
                        <i class="bi bi-download me-1"></i> ‰∏ãËΩΩÂà∞Ê≠§ÁõÆÂΩï
                    </button>
                </div>
            </div>
        </div>
    </div>

	    <div id="imagePreviewModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1100;">
	        <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;">
	            <img alt="preview" style="max-width: 95vw; max-height: 85vh; object-fit: contain; user-select: none; cursor: grab;">
	        </div>
	        <button id="imagePreviewCloseBtn" type="button" class="image-preview-close-btn" style="position: absolute; top: 16px; right: 16px; z-index: 1202;">
	            ÂÖ≥Èó≠
	        </button>
	        <div id="imagePreviewCaption"></div>
	        <div class="image-preview-nav">
	            <button id="imagePrevBtn" type="button" class="image-preview-nav-btn" aria-label="‰∏ä‰∏ÄÂº†">‚Äπ</button>
	            <button id="imageNextBtn" type="button" class="image-preview-nav-btn" aria-label="‰∏ã‰∏ÄÂº†">‚Ä∫</button>
	        </div>
	    </div>

    <div id="imageGridModal" style="display: none; position: fixed; inset: 0; overflow: auto; background: #11161f; z-index: 1050;">
        <div class="image-grid-header">
            <div class="image-grid-header-left">
                <div class="image-grid-title">
                    <i class="bi bi-grid-3x3-gap me-1"></i> ÂõæÁâáÁΩëÊ†º
                </div>
                <div class="image-grid-cols-control">
                    <span class="image-grid-cols-label">ÂàóÊï∞</span>
                    <div id="imageGridColsButtons" class="image-grid-cols-buttons">
                        <button type="button" class="image-grid-cols-btn" data-cols="4">4</button>
                        <button type="button" class="image-grid-cols-btn" data-cols="6">6</button>
                        <button type="button" class="image-grid-cols-btn active" data-cols="8">8</button>
                        <button type="button" class="image-grid-cols-btn" data-cols="10">10</button>
                        <button type="button" class="image-grid-cols-btn" data-cols="12">12</button>
                    </div>
                </div>
            </div>
            <button type="button" class="image-grid-cols-btn image-grid-close-btn" onclick="closeImageGrid()">ÂÖ≥Èó≠</button>
        </div>
        <div id="imageGridContainer"></div>
    </div>

    <div id="diffModal">
        <div class="diff-dialog">
            <div class="diff-header">
                <div class="paths">
                    <span id="diffLeftPath"></span>
                    <span>‚Üî</span>
                    <span id="diffRightPath"></span>
                </div>
                <button type="button" class="diff-close-btn" onclick="closeDiffModal()">ÂÖ≥Èó≠</button>
            </div>
            <div class="diff-body">
                <div class="diff-grid">
                    <div id="diffRows" class="diff-rows"></div>
                </div>
                <div id="diffSummary" class="diff-summary"></div>
            </div>
        </div>
    </div>

    <div id="editorModal" class="editor-modal">
        <div class="editor-dialog">
            <div class="editor-header">
                <div class="editor-title modal-title">
                    <i class="bi bi-file-earmark-text"></i>
                    <span>ÊñáÊú¨ÁºñËæëÂô®</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEditorTheme()">ÂàáÊç¢ËÉåÊôØ</button>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="showFindReplace(false)">Êü•Êâæ</button>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="showFindReplace(true)">ÊõøÊç¢</button>
                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEditorContent()">‰øùÂ≠ò</button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="closeEditorModal()">ÂÖ≥Èó≠</button>
                </div>
            </div>
            <div class="editor-body">
                <div id="editorGutter" class="editor-gutter">
                    <div id="editorLineNumbers" class="editor-line-numbers"></div>
                </div>
                <div class="editor-text-wrapper">
                    <pre id="editorHighlightLayer" class="editor-highlight-layer"></pre>
                    <textarea id="editorTextarea" class="editor-textarea" spellcheck="false"></textarea>
                </div>
            </div>
            <div id="findReplaceBar" class="find-replace-bar">
                <input id="findInput" type="text" placeholder="Êü•Êâæ" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                <span id="findCount" class="text-muted" style="font-size: 12px;"></span>
                <button type="button" onclick="findNext()">‰∏ã‰∏Ä‰∏™</button>
                <input id="replaceInput" type="text" placeholder="ÊõøÊç¢" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                <button id="replaceBtn" type="button" onclick="replaceOne()">ÊõøÊç¢</button>
                <button id="replaceAllBtn" type="button" onclick="replaceAll()">ÂÖ®ÈÉ®ÊõøÊç¢</button>
                <button type="button" class="secondary" onclick="hideFindReplace()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>
<!-- Transfer log modal -->
    <div class="modal fade" id="logModal" tabindex="-1" aria-labelledby="logModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logModalLabel">
                        <i class="bi bi-journal-text text-secondary"></i> ‰º†ËæìÊó•Âøó
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-muted">ÂÆûÊó∂ÊòæÁ§∫‰º†ËæìËøáÁ®ã‰∏≠ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ</small>
                        <div class="d-flex align-items-center" style="gap: 6px; flex-wrap: wrap;">
                            <div class="input-group input-group-sm" style="width: 240px;">
                                <input id="runInputBox" type="text" class="form-control" placeholder="ÂêëËÑöÊú¨ËæìÂÖ•ÂÜÖÂÆπÔºåÂõûËΩ¶ÂèëÈÄÅ"
                                       onkeydown="if(event.key === 'Enter'){ event.preventDefault(); sendRunInput(); }">
                                <button id="runSendBtn" class="btn btn-outline-primary" type="button" onclick="sendRunInput()">ÂèëÈÄÅ</button>
                            </div>
                            <button id="runStopBtn" class="btn btn-outline-primary btn-sm" onclick="cancelCurrentRun()" style="font-size: 0.75rem;">
                                <i class="bi bi-stop-circle"></i> ÂÅúÊ≠¢ËÑöÊú¨
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearLog()" style="font-size: 0.75rem;">
                                <i class="bi bi-trash3"></i> Ê∏ÖÁ©∫Êó•Âøó
                            </button>
                        </div>
                    </div>
                    <div id="logContainer" class="log-container">
                        <div id="logContent" class="log-content">
                            <!-- Log content renders here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified alert/confirm/input dialog -->
    <div class="modal fade" id="uiDialogModal" tabindex="-1" aria-labelledby="uiDialogTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered ui-dialog">
            <div class="modal-content ui-dialog-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uiDialogTitle">ÊèêÁ§∫</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="uiDialogMessage" class="ui-dialog-message"></div>
                    <ul id="uiDialogList" class="ui-dialog-list list-unstyled" style="display: none;"></ul>
                    <div id="uiDialogWarning" class="ui-dialog-warning" style="display: none;">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <span></span>
                    </div>
                    <div id="uiDialogInputRow" class="ui-dialog-input-row" style="display: none;">
                        <input id="uiDialogInput" type="text" class="form-control form-control-sm" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light btn-sm" id="uiDialogCancel">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary btn-sm" id="uiDialogConfirm">Á°ÆÂÆö</button>
                </div>
            </div>
        </div>
    </div>

	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
	    <script id="turbofileBoot" type="application/json">
	      {{ {
	        'servers': servers,
	        'remembered_paths': remembered_paths,
	        'client_ipv4': (client_ipv4 | default(none, true)),
	        'transfer_bytes_enabled': transfer_bytes_enabled
	      } | tojson }}
	    </script>
	    <script>
	      (function () {
	        try {
	          const el = document.getElementById('turbofileBoot');
	          window.TURBOFILE_BOOT = el ? JSON.parse(el.textContent || '{}') : {};
	        } catch (e) {
	          window.TURBOFILE_BOOT = {};
	          console.error('Failed to parse TURBOFILE_BOOT:', e);
	        }
	      })();
	    </script>
	    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
	</body>
	</html>
