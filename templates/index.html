<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æé€Ÿä¼  - é«˜é€Ÿæ–‡ä»¶ä¼ è¾“ç³»ç»Ÿ</title>

    <!-- Favicon - é—ªç”µå›¾æ ‡ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path fill='%23ffc107' d='M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z'/></svg>" type="image/svg+xml">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --secondary-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .container-fluid {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            margin: 2px;
            padding: 6px;
            max-width: calc(100vw - 4px);
            height: calc(100vh - 4px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .file-browser {
            height: calc(var(--browse-height, 50vh));
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            /* é˜²æ­¢æ»šåŠ¨äº‹ä»¶å†’æ³¡åˆ°çˆ¶å…ƒç´  */
            overscroll-behavior: contain;
            /* ç¡®ä¿æ»šåŠ¨å¹³æ»‘ */
            scroll-behavior: smooth;
            /* è®¾ç½®æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }

        .file-browser:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        /* WebKitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
        .file-browser::-webkit-scrollbar {
            width: 8px;
        }

        .file-browser::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .file-browser::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .file-browser::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .file-item {
            cursor: pointer;
            padding: 6px 10px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.85rem;
            line-height: 1.4;
            user-select: none;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin: 1px 2px;
        }

        .file-item:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateX(4px);
            box-shadow: var(--shadow-sm);
        }

        .file-item.selected {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .file-item.selected:hover {
            background: var(--gradient-primary);
            filter: brightness(1.1);
        }

        .file-item i {
            margin-right: 8px;
            width: 16px;
            text-align: center;
            font-size: 0.8rem;
        }

        .file-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            flex: 1;
            font-weight: 500;
        }

        .file-details {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-left: 10px;
            font-weight: 400;
        }

        .file-item.selected .file-details {
            opacity: 0.9;
        }

        .progress-container {
            display: none;
        }

        .server-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 4px 6px;
            margin-bottom: 3px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .server-panel:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }



        /* æ‹–æ‹½ç›¸å…³æ ·å¼ */
        .file-item.dragging {
            opacity: 0.6;
            transform: rotate(2deg) scale(0.95);
        }

        .file-browser.drag-over {
            border: 3px dashed var(--primary-color);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .drag-preview {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            background: var(--gradient-primary);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        /* åˆ†éš”æ¡æ ·å¼ */
        .resizer {
            background: linear-gradient(135deg, var(--border-color) 0%, #cbd5e1 100%);
            cursor: col-resize;
            width: 8px;
            position: relative;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .resizer:hover {
            background: var(--gradient-primary);
            transform: scaleX(1.2);
        }



        /* è·¯å¾„å¯¼èˆªæ ·å¼ */
        .path-nav {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 12px;
            font-size: 0.875rem;
            font-family: 'JetBrains Mono', monospace;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .path-nav:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .path-segment {
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .path-segment:hover {
            background: var(--primary-color);
            color: white;
            text-decoration: none;
        }

        .path-separator {
            margin: 0 6px;
            color: var(--text-secondary);
            font-weight: 300;
        }

        /* è°ƒæ•´å®¹å™¨å¸ƒå±€ */
        .resizable-container {
            display: flex;
            height: 100%;
            gap: 8px;
        }

        .resizable-panel {
            overflow: visible;
            background: var(--card-bg);
            border-radius: 6px;
            padding: 3px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            /* ç¡®ä¿é¢æ¿å†…çš„æ»šåŠ¨ä¸å½±å“å¤–éƒ¨ */
            position: relative;
        }

        .resizable-panel:hover {
            box-shadow: var(--shadow-md);
        }
        /* ç°ä»£åŒ–æŒ‰é’®æ ·å¼ */
        .btn {
            border-radius: 4px;
            font-weight: 500;
            padding: 6px 12px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--gradient-primary);
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: white;
        }

        .btn-outline-secondary {
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            background: var(--card-bg);
        }

        .btn-outline-secondary:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* è¡¨å•æ§ä»¶æ ·å¼ */
        .form-select, .form-control {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 5px 8px;
            transition: all 0.3s ease;
            background: var(--card-bg);
            font-size: 0.9rem;
        }

        .form-select:focus, .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--card-bg);
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            background: var(--card-bg);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-body {
            padding: 4px 6px;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress {
            border-radius: 10px;
            background: var(--light-bg);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .progress-bar {
            background: var(--gradient-success);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .progress-bar-animated {
            animation: progress-bar-stripes 1s linear infinite;
        }

        /* æ ‡é¢˜æ ·å¼ */
        h4, h6 {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .main-title {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 3px;
            margin-top: 4px;
            text-align: center;
        }

        /* ç¡®ä¿å®Œå…¨å•å±æ˜¾ç¤º */
        .flex-shrink-0 {
            flex-shrink: 0;
        }

        .flex-grow-1 {
            flex-grow: 1;
            min-height: 0;
        }

        /* é˜²æ­¢æ»šåŠ¨å†²çªçš„é¢å¤–æ ·å¼ */
        .resizable-container {
            /* ç¡®ä¿å®¹å™¨ä¸ä¼šäº§ç”Ÿæ»šåŠ¨æ¡ */
            overflow: hidden;
            /* é˜²æ­¢æ»šåŠ¨äº‹ä»¶ä¼ æ’­ */
            overscroll-behavior: contain;
        }

        /* ç¡®ä¿æ–‡ä»¶æµè§ˆå™¨åŒºåŸŸçš„æ»šåŠ¨ç‹¬ç«‹æ€§ */
        #sourceFileBrowser, #targetFileBrowser {
            /* é˜²æ­¢æ»šåŠ¨äº‹ä»¶å†’æ³¡ */
            overscroll-behavior: contain;
            /* ç¡®ä¿æ»šåŠ¨åŒºåŸŸæ˜ç¡®å®šä¹‰ */
            position: relative;
            /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
            will-change: scroll-position;
        }

        /* è·¯å¾„å¯¼èˆªä¼˜åŒ– */
        .path-nav {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 2px 6px;
            margin-bottom: 4px;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            box-shadow: var(--shadow-sm);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container-fluid {
                margin: 1px;
                padding: 4px;
                border-radius: 6px;
            }

            .resizable-container {
                flex-direction: column;
                gap: 4px;
            }

            .resizable-panel {
                padding: 3px;
            }

            .main-title {
                font-size: 1.1rem;
                margin-bottom: 4px;
            }

            .server-panel {
                padding: 4px 6px;
                margin-bottom: 3px;
            }

            .file-item {
                padding: 4px 6px;
                font-size: 0.8rem;
            }

            .btn {
                font-size: 0.85rem;
                padding: 5px 10px;
            }
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 576px) {
            .col-md-6 {
                padding-left: 3px;
                padding-right: 3px;
            }

            .input-group .btn {
                padding: 4px 8px;
                font-size: 0.8rem;
            }

            .main-title {
                font-size: 1rem;
            }

            .file-item {
                font-size: 0.75rem;
                padding: 3px 5px;
            }
        }

        /* é«˜åº¦é™åˆ¶ä¼˜åŒ– */
        @media (max-height: 800px) {
            .main-title {
                font-size: 1.1rem;
                margin-bottom: 2px;
                margin-top: 2px;
            }

            .server-panel {
                padding: 3px 5px;
                margin-bottom: 2px;
            }

            .card-body {
                padding: 3px 5px;
            }

            .file-item {
                padding: 4px 6px;
            }

            .btn {
                padding: 4px 8px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="row flex-shrink-0">
            <div class="col-12">
                <h4 class="main-title">
                    <i class="bi bi-lightning-charge-fill" style="color: #ffc107; font-size: 1.2em;"></i>
                    æé€Ÿä¼ 
                    <small class="d-block" style="font-size: 0.7em; opacity: 0.8;">é«˜é€Ÿæ–‡ä»¶ä¼ è¾“ç³»ç»Ÿ</small>
                </h4>
            </div>
        </div>

        <!-- æœåŠ¡å™¨é€‰æ‹©é¢æ¿ -->
        <div class="row g-1 flex-shrink-0">
            <div class="col-md-6">
                <div class="server-panel">
                    <h6 style="font-size: 0.9rem; margin-bottom: 3px;">
                        <i class="bi bi-hdd-network-fill text-primary"></i> æºæœåŠ¡å™¨
                    </h6>
                    <select id="sourceServer" class="form-select mb-2">
                        <option value="">ğŸ” è¯·é€‰æ‹©æºæœåŠ¡å™¨</option>
                        {% for ip, info in servers.items() %}
                        <option value="{{ ip }}">ğŸ–¥ï¸ {{ info.name }} ({{ ip }})</option>
                        {% endfor %}
                    </select>
                    <div class="input-group">
                        <span class="input-group-text" style="padding: 4px 6px;">
                            <i class="bi bi-folder2-open text-warning" style="font-size: 0.85rem;"></i>
                        </span>
                        <input type="text" id="sourcePath" class="form-control" placeholder="æºè·¯å¾„" value="">
                        <button class="btn btn-outline-secondary" onclick="browseSource()">æµè§ˆ</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="server-panel">
                    <h6 style="font-size: 0.9rem; margin-bottom: 3px;">
                        <i class="bi bi-cloud-upload-fill text-success"></i> ç›®æ ‡æœåŠ¡å™¨
                    </h6>
                    <select id="targetServer" class="form-select mb-2">
                        <option value="">ğŸ¯ è¯·é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨</option>
                        {% for ip, info in servers.items() %}
                        <option value="{{ ip }}">ğŸ–¥ï¸ {{ info.name }} ({{ ip }})</option>
                        {% endfor %}
                    </select>
                    <div class="input-group">
                        <span class="input-group-text" style="padding: 4px 6px;">
                            <i class="bi bi-folder-plus text-success" style="font-size: 0.85rem;"></i>
                        </span>
                        <input type="text" id="targetPath" class="form-control" placeholder="ç›®æ ‡è·¯å¾„" value="">
                        <button class="btn btn-outline-secondary" onclick="browseTarget()">æµè§ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶æµè§ˆå™¨ -->
        <div class="row flex-grow-1" style="min-height: 0;">
            <div class="resizable-container" style="height: 100%;">
                <div class="resizable-panel" id="sourcePanel" style="width: 50%; height: 100%;">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <h6 style="font-size: 0.9rem; margin-bottom: 0;">
                            <i class="bi bi-files text-info"></i> æºæ–‡ä»¶æµè§ˆ
                        </h6>
                        <div class="form-check form-switch" style="font-size: 0.75rem;">
                            <input class="form-check-input" type="checkbox" id="sourceShowHidden" onchange="toggleHiddenFiles('source')">
                            <label class="form-check-label" for="sourceShowHidden" style="font-size: 0.75rem;">
                                æ˜¾ç¤ºéšè—æ–‡ä»¶
                            </label>
                        </div>
                    </div>
                    <div id="sourcePathNav" class="path-nav" style="display: none; padding: 3px 8px; font-size: 0.8rem;">
                        <i class="bi bi-geo-alt-fill text-primary me-1"></i>
                        <span id="sourcePathDisplay">/</span>
                    </div>
                    <div id="sourceFileBrowser" class="file-browser" style="height: calc(100% - 35px);">
                        <div class="text-center text-muted p-3">
                            <i class="bi bi-server fs-3 mb-2 d-block opacity-50"></i>
                            <p class="mb-0" style="font-size: 0.85rem;">è¯·å…ˆé€‰æ‹©æºæœåŠ¡å™¨</p>
                        </div>
                    </div>
                </div>

                <div class="resizer" id="verticalResizer"></div>

                <div class="resizable-panel" id="targetPanel" style="width: 50%; height: 100%;">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <h6 style="font-size: 0.9rem; margin-bottom: 0;">
                            <i class="bi bi-folder-check text-success"></i> ç›®æ ‡ç›®å½•æµè§ˆ
                        </h6>
                        <div class="form-check form-switch" style="font-size: 0.75rem;">
                            <input class="form-check-input" type="checkbox" id="targetShowHidden" onchange="toggleHiddenFiles('target')">
                            <label class="form-check-label" for="targetShowHidden" style="font-size: 0.75rem;">
                                æ˜¾ç¤ºéšè—æ–‡ä»¶
                            </label>
                        </div>
                    </div>
                    <div id="targetPathNav" class="path-nav" style="display: none; padding: 3px 8px; font-size: 0.8rem;">
                        <i class="bi bi-geo-alt-fill text-success me-1"></i>
                        <span id="targetPathDisplay">/</span>
                    </div>
                    <div id="targetFileBrowser" class="file-browser" style="height: calc(100% - 35px);">
                        <div class="text-center text-muted p-3">
                            <i class="bi bi-cloud-upload fs-3 mb-2 d-block opacity-50"></i>
                            <p class="mb-0" style="font-size: 0.85rem;">è¯·å…ˆé€‰æ‹©ç›®æ ‡æœåŠ¡å™¨</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¼ è¾“æ§åˆ¶é¢æ¿ -->
        <div class="row flex-shrink-0">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-center g-1">
                            <div class="col-md-3">
                                <select id="transferMode" class="form-select form-select-sm">
                                    <option value="copy">ğŸ“‹ å¤åˆ¶</option>
                                    <option value="move">âœ‚ï¸ ç§»åŠ¨</option>
                                </select>
                            </div>
                            <div class="col-md-6 text-center">
                                <button id="startTransferBtn" class="btn btn-primary me-2" onclick="startTransfer()">
                                    <i class="bi bi-lightning-charge-fill"></i> å¼€å§‹ä¼ è¾“
                                </button>
                                <button id="cancelTransferBtn" class="btn btn-danger" onclick="cancelTransfer()" style="display: none;">
                                    <i class="bi bi-stop-circle-fill"></i> å–æ¶ˆä¼ è¾“
                                </button>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="fastSSH" checked>
                                    <label class="form-check-label" style="font-size: 0.85rem;" for="fastSSH">
                                        ğŸš€ SSHåŠ é€Ÿ
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦æ˜¾ç¤º -->
        <div class="row flex-shrink-0">
            <div class="col-12">
                <div id="progressContainer" class="progress-container">
                    <div class="card">
                        <div class="card-body">
                            <div class="progress mb-2" style="height: 20px;">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                                     role="progressbar" style="width: 0%; font-weight: 600; font-size: 13px; line-height: 20px;">0%</div>
                            </div>
                            <div class="row g-2">
                                <div class="col-6 col-md-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-speedometer text-info me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">é€Ÿåº¦</small>
                                            <div id="transferSpeed" class="fw-bold" style="font-size: 0.85rem;">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-download text-success me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">å·²ä¼ è¾“</small>
                                            <div id="transferredBytes" class="fw-bold" style="font-size: 0.85rem;">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-clock text-warning me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">æ—¶é—´</small>
                                            <div id="eta" class="fw-bold" style="font-size: 0.85rem;">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-info-circle text-primary me-1" style="font-size: 0.85rem;"></i>
                                        <div>
                                            <small class="text-muted" style="font-size: 0.75em;">çŠ¶æ€</small>
                                            <div id="transferStatus" class="fw-bold" style="font-size: 0.85rem;">å‡†å¤‡ä¸­</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        // WebSocketè¿æ¥
        const socket = io();
        let currentTransferId = null;
        let selectedSourceFiles = [];
        let currentSourcePath = '/home/th';
        let currentTargetPath = '/home/thgd';

        // æ—¥å¿—å‡½æ•° - ä¿æŒå…¼å®¹æ€§ä½†ä¸æ˜¾ç¤ºUI
        function addLog(message) {
            // æ—¥å¿—åŠŸèƒ½å·²ç§»é™¤ï¼Œä½†ä¿æŒå‡½æ•°å…¼å®¹æ€§
            // å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡ºæ—¥å¿—ç”¨äºè°ƒè¯•
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
        }

        // æµè§ˆæºæ–‡ä»¶
        function browseSource() {
            const server = document.getElementById('sourceServer').value;
            const path = document.getElementById('sourcePath').value;
            const showHidden = document.getElementById('sourceShowHidden').checked;

            if (!server) {
                alert('è¯·å…ˆé€‰æ‹©æºæœåŠ¡å™¨');
                return;
            }

            fetch(`/api/browse/${server}?path=${encodeURIComponent(path)}&show_hidden=${showHidden}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayFiles('sourceFileBrowser', data.files, path, true);
                    } else {
                        addLog(`æµè§ˆæºç›®å½•å¤±è´¥: ${data.error}`);
                    }
                })
                .catch(error => {
                    addLog(`æµè§ˆæºç›®å½•å‡ºé”™: ${error}`);
                });
        }

        // æµè§ˆç›®æ ‡æ–‡ä»¶
        function browseTarget() {
            const server = document.getElementById('targetServer').value;
            const path = document.getElementById('targetPath').value;
            const showHidden = document.getElementById('targetShowHidden').checked;

            if (!server) {
                alert('è¯·å…ˆé€‰æ‹©ç›®æ ‡æœåŠ¡å™¨');
                return;
            }

            fetch(`/api/browse/${server}?path=${encodeURIComponent(path)}&show_hidden=${showHidden}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayFiles('targetFileBrowser', data.files, path, false);
                    } else {
                        addLog(`æµè§ˆç›®æ ‡ç›®å½•å¤±è´¥: ${data.error}`);
                    }
                })
                .catch(error => {
                    addLog(`æµè§ˆç›®æ ‡ç›®å½•å‡ºé”™: ${error}`);
                });
        }

        // åˆ‡æ¢éšè—æ–‡ä»¶æ˜¾ç¤º
        function toggleHiddenFiles(type) {
            if (type === 'source') {
                const server = document.getElementById('sourceServer').value;
                const path = document.getElementById('sourcePath').value;
                if (server && path) {
                    browseSource();
                }
            } else if (type === 'target') {
                const server = document.getElementById('targetServer').value;
                const path = document.getElementById('targetPath').value;
                if (server && path) {
                    browseTarget();
                }
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
        function displayFiles(containerId, files, currentPath, isSource) {
            const container = document.getElementById(containerId);
            let html = '';

            // æ›´æ–°è·¯å¾„å¯¼èˆª
            updatePathNavigation(currentPath, isSource);

            // è¿”å›ä¸Šçº§ç›®å½•
            if (currentPath !== '/') {
                const parentPath = currentPath.split('/').slice(0, -1).join('/') || '/';
                html += `<div class="file-item" onclick="navigateTo('${containerId}', '${parentPath}', ${isSource})">
                    <i class="bi bi-arrow-up-circle text-primary"></i>
                    <div class="file-info">
                        <span class="file-name">..</span>
                    </div>
                </div>`;
            }

            // æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
            files.forEach((file, index) => {
                const icon = file.is_directory ? 'bi-folder-fill text-warning' : 'bi-file-earmark text-info';
                const size = file.is_directory ? '' : formatFileSize(file.size);
                const fileId = `file_${containerId}_${index}`;

                if (isSource) {
                    // æºæ–‡ä»¶æ”¯æŒå¤šé€‰ã€åŒå‡»è¿›å…¥ç›®å½•å’Œæ‹–æ‹½
                    html += `<div class="file-item selectable" id="${fileId}"
                             draggable="true"
                             data-path="${file.path}"
                             data-name="${file.name}"
                             data-is-directory="${file.is_directory}"
                             onclick="selectFile(event, '${file.path}', '${file.name}', ${file.is_directory}, '${fileId}')"
                             ondblclick="handleDoubleClick('${file.path}', ${file.is_directory}, ${isSource})"
                             ondragstart="handleDragStart(event)"
                             ondragend="handleDragEnd(event)">
                        <i class="bi ${icon}"></i>
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-details">${size} ${file.modified}</span>
                        </div>
                    </div>`;
                } else {
                    // ç›®æ ‡ç›®å½•åªæ”¯æŒå¯¼èˆª
                    html += `<div class="file-item"
                             ondblclick="handleDoubleClick('${file.path}', ${file.is_directory}, ${isSource})">
                        <i class="bi ${icon}"></i>
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-details">${size} ${file.modified}</span>
                        </div>
                    </div>`;
                }
            });

            container.innerHTML = html;

            // ä¸ºç›®æ ‡æ–‡ä»¶æµè§ˆå™¨æ·»åŠ æ‹–æ‹½æ¥æ”¶åŠŸèƒ½
            if (!isSource) {
                setupDropZone(container);
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + sizes[i];
        }

        // å¯¼èˆªåˆ°ç›®å½•
        function navigateTo(containerId, path, isSource) {
            if (isSource) {
                document.getElementById('sourcePath').value = path;
                browseSource();
            } else {
                document.getElementById('targetPath').value = path;
                browseTarget();
            }
        }

        // å¤„ç†åŒå‡»äº‹ä»¶
        function handleDoubleClick(path, isDirectory, isSource) {
            if (isDirectory) {
                // åŒå‡»ç›®å½•è¿›å…¥è¯¥ç›®å½•
                if (isSource) {
                    document.getElementById('sourcePath').value = path;
                    browseSource();
                } else {
                    document.getElementById('targetPath').value = path;
                    browseTarget();
                }
            }
        }

        // æ›´æ–°è·¯å¾„å¯¼èˆª
        function updatePathNavigation(currentPath, isSource) {
            const navId = isSource ? 'sourcePathNav' : 'targetPathNav';
            const displayId = isSource ? 'sourcePathDisplay' : 'targetPathDisplay';
            const nav = document.getElementById(navId);
            const display = document.getElementById(displayId);

            if (currentPath && currentPath !== '/') {
                nav.style.display = 'block';
                const pathParts = currentPath.split('/').filter(part => part);
                let html = '<a href="#" class="path-segment" onclick="navigateToPath(\'/\', ' + isSource + ')">æ ¹ç›®å½•</a>';

                let buildPath = '';
                pathParts.forEach((part, index) => {
                    buildPath += '/' + part;
                    html += '<span class="path-separator">/</span>';
                    html += `<a href="#" class="path-segment" onclick="navigateToPath('${buildPath}', ${isSource})">${part}</a>`;
                });

                display.innerHTML = html;
            } else {
                nav.style.display = 'block';
                display.innerHTML = '<span class="path-segment">æ ¹ç›®å½•</span>';
            }
        }

        // å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„
        function navigateToPath(path, isSource) {
            if (isSource) {
                document.getElementById('sourcePath').value = path;
                browseSource();
            } else {
                document.getElementById('targetPath').value = path;
                browseTarget();
            }
        }

        // é€‰æ‹©æ–‡ä»¶ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
        function selectFile(event, path, name, isDirectory, fileId) {
            event.stopPropagation();

            const fileElement = document.getElementById(fileId);

            if (event.ctrlKey || event.metaKey) {
                // Ctrl+ç‚¹å‡»å¤šé€‰
                if (fileElement.classList.contains('selected')) {
                    selectedSourceFiles = selectedSourceFiles.filter(f => f.path !== path);
                    fileElement.classList.remove('selected');
                } else {
                    selectedSourceFiles.push({path, name, is_directory: isDirectory});
                    fileElement.classList.add('selected');
                }
            } else {
                // å•é€‰
                clearAllSelections();
                fileElement.classList.add('selected');
                selectedSourceFiles = [{path, name, is_directory: isDirectory}];
            }

            updateSelectionInfo();
        }

        // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
        function clearAllSelections() {
            selectedSourceFiles = [];
            document.querySelectorAll('.file-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
        }

        // æ›´æ–°é€‰æ‹©ä¿¡æ¯
        function updateSelectionInfo() {
            if (selectedSourceFiles.length > 0) {
                const names = selectedSourceFiles.map(f => f.name).join(', ');
                addLog(`å·²é€‰æ‹© ${selectedSourceFiles.length} é¡¹: ${names}`);
            }
        }

        // æ‹–æ‹½å¼€å§‹
        function handleDragStart(event) {
            const fileElement = event.target.closest('.file-item');
            const path = fileElement.dataset.path;
            const name = fileElement.dataset.name;
            const isDirectory = String(fileElement.dataset.isDirectory).toLowerCase() === 'true';

            // å¦‚æœæ‹–æ‹½çš„æ–‡ä»¶æ²¡æœ‰è¢«é€‰ä¸­ï¼Œåˆ™é€‰ä¸­å®ƒ
            if (!fileElement.classList.contains('selected')) {
                clearAllSelections();
                fileElement.classList.add('selected');
                selectedSourceFiles = [{path, name, is_directory: isDirectory}];
            }

            // è®¾ç½®æ‹–æ‹½æ•°æ®
            event.dataTransfer.setData('text/plain', JSON.stringify(selectedSourceFiles));
            event.dataTransfer.effectAllowed = 'copy';

            // åˆ›å»ºæ‹–æ‹½é¢„è§ˆ
            const dragPreview = document.createElement('div');
            dragPreview.className = 'drag-preview';
            dragPreview.textContent = selectedSourceFiles.length > 1
                ? `${selectedSourceFiles.length} ä¸ªé¡¹ç›®`
                : name;
            document.body.appendChild(dragPreview);

            // è®¾ç½®æ‹–æ‹½å›¾åƒ
            event.dataTransfer.setDragImage(dragPreview, 10, 10);

            // å»¶è¿Ÿç§»é™¤é¢„è§ˆå…ƒç´ 
            setTimeout(() => {
                if (document.body.contains(dragPreview)) {
                    document.body.removeChild(dragPreview);
                }
            }, 0);

            fileElement.classList.add('dragging');
        }

        // æ‹–æ‹½ç»“æŸ
        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            document.querySelectorAll('.file-browser.drag-over').forEach(browser => {
                browser.classList.remove('drag-over');
            });
        }

        // è®¾ç½®æ‹–æ”¾åŒºåŸŸ
        function setupDropZone(container) {
            container.addEventListener('dragover', function(event) {
                event.preventDefault();
                event.dataTransfer.dropEffect = 'copy';
                container.classList.add('drag-over');
            });

            container.addEventListener('dragleave', function(event) {
                if (!container.contains(event.relatedTarget)) {
                    container.classList.remove('drag-over');
                }
            });

            container.addEventListener('drop', function(event) {
                event.preventDefault();
                container.classList.remove('drag-over');

                try {
                    const draggedFiles = JSON.parse(event.dataTransfer.getData('text/plain'));
                    if (draggedFiles && draggedFiles.length > 0) {
                        // è‡ªåŠ¨å¼€å§‹ä¼ è¾“
                        selectedSourceFiles = draggedFiles;
                        startTransferFromDrag();
                    }
                } catch (e) {
                    console.error('æ‹–æ‹½æ•°æ®è§£æå¤±è´¥:', e);
                }
            });
        }

        // ä»æ‹–æ‹½å¼€å§‹ä¼ è¾“
        function startTransferFromDrag() {
            const sourceServer = document.getElementById('sourceServer').value;
            const targetServer = document.getElementById('targetServer').value;
            const targetPath = document.getElementById('targetPath').value;

            if (!sourceServer || !targetServer || !targetPath) {
                alert('è¯·ç¡®ä¿å·²é€‰æ‹©æºæœåŠ¡å™¨ã€ç›®æ ‡æœåŠ¡å™¨å’Œç›®æ ‡è·¯å¾„');
                return;
            }

            addLog('é€šè¿‡æ‹–æ‹½å¼€å§‹ä¼ è¾“...');
            startTransfer();
        }

        // å¼€å§‹ä¼ è¾“
        function startTransfer() {
            const sourceServer = document.getElementById('sourceServer').value;
            const targetServer = document.getElementById('targetServer').value;
            const targetPath = document.getElementById('targetPath').value;
            const mode = document.getElementById('transferMode').value;
            const fastSSH = document.getElementById('fastSSH').checked;

            if (!sourceServer || !targetServer || !targetPath) {
                alert('è¯·é€‰æ‹©æºæœåŠ¡å™¨ã€ç›®æ ‡æœåŠ¡å™¨å’Œç›®æ ‡è·¯å¾„');
                return;
            }

            if (selectedSourceFiles.length === 0) {
                alert('è¯·é€‰æ‹©è¦ä¼ è¾“çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹');
                return;
            }

            if (sourceServer === targetServer) {
                // æ£€æŸ¥æ˜¯å¦æœ‰è·¯å¾„å†²çª
                const hasConflict = selectedSourceFiles.some(file =>
                    file.path === targetPath || targetPath.startsWith(file.path + '/')
                );
                if (hasConflict) {
                    alert('æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„ä¸èƒ½ç›¸åŒæˆ–å­˜åœ¨åŒ…å«å…³ç³»');
                    return;
                }
            }

            // æ˜¾ç¤ºè¿›åº¦é¢æ¿
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('startTransferBtn').style.display = 'none';
            document.getElementById('cancelTransferBtn').style.display = 'inline-block';

            const fileNames = selectedSourceFiles.map(f => f.name).join(', ');
            addLog(`å¼€å§‹ä¼ è¾“ ${selectedSourceFiles.length} é¡¹: ${fileNames} -> ${targetServer}:${targetPath} (${mode})`);

            // å‘é€ä¼ è¾“è¯·æ±‚
            socket.emit('start_transfer', {
                source_server: sourceServer,
                source_files: selectedSourceFiles,
                target_server: targetServer,
                target_path: targetPath,
                mode: mode,
                fast_ssh: fastSSH
            });
        }

        // å–æ¶ˆä¼ è¾“
        function cancelTransfer() {
            if (currentTransferId) {
                // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                if (confirm('ç¡®å®šè¦å–æ¶ˆå½“å‰ä¼ è¾“å—ï¼Ÿ\n\næ³¨æ„ï¼šå·²ä¼ è¾“çš„éƒ¨åˆ†æ–‡ä»¶å°†ä¿ç•™ï¼Œä½†å½“å‰æ­£åœ¨ä¼ è¾“çš„æ–‡ä»¶å¯èƒ½ä¸å®Œæ•´ã€‚')) {
                    addLog('æ­£åœ¨å–æ¶ˆä¼ è¾“...');

                    // ç¦ç”¨å–æ¶ˆæŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
                    const cancelBtn = document.getElementById('cancelTransferBtn');
                    cancelBtn.disabled = true;
                    cancelBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> å–æ¶ˆä¸­...';

                    // å‘é€å–æ¶ˆè¯·æ±‚
                    socket.emit('cancel_transfer', {
                        transfer_id: currentTransferId
                    });
                }
            }
        }

        // é‡ç½®ä¼ è¾“ç•Œé¢
        function resetTransferUI() {
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('startTransferBtn').style.display = 'inline-block';

            // é‡ç½®å–æ¶ˆæŒ‰é’®
            const cancelBtn = document.getElementById('cancelTransferBtn');
            cancelBtn.style.display = 'none';
            cancelBtn.disabled = false;
            cancelBtn.innerHTML = '<i class="bi bi-stop-circle-fill"></i> å–æ¶ˆ';

            // é‡ç½®è¿›åº¦æ¡
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            progressBar.classList.remove('bg-success', 'bg-danger');
            progressBar.classList.add('progress-bar-animated');

            // é‡ç½®çŠ¶æ€ä¿¡æ¯
            document.getElementById('transferStatus').textContent = 'å‡†å¤‡ä¸­';
            document.getElementById('transferSpeed').textContent = '-';
            document.getElementById('transferredBytes').textContent = '-';
            document.getElementById('eta').textContent = '-';

            currentTransferId = null;
        }

        // WebSocketäº‹ä»¶å¤„ç†
        socket.on('transfer_started', function(data) {
            currentTransferId = data.transfer_id;
            document.getElementById('transferStatus').textContent = 'ä¼ è¾“ä¸­...';
            addLog(`ä¼ è¾“ä»»åŠ¡å·²å¯åŠ¨ (ID: ${data.transfer_id})`);
        });

        socket.on('transfer_progress', function(data) {
            if (data.transfer_id === currentTransferId) {
                const progress = data.progress;
                const percentage = Math.round(progress.percentage || 0);

                // æ›´æ–°è¿›åº¦æ¡ - ç¡®ä¿ç²¾ç¡®åº¦
                document.getElementById('progressBar').style.width = percentage + '%';
                document.getElementById('progressBar').textContent = percentage + '%';

                // æ›´æ–°çŠ¶æ€ä¿¡æ¯
                if (progress.current_file) {
                    document.getElementById('transferStatus').textContent =
                        `ä¼ è¾“ä¸­: ${progress.current_file} (${progress.completed_files || 0}/${progress.total_files || 1})`;
                } else if (progress.files_transferred && progress.total_files) {
                    document.getElementById('transferStatus').textContent =
                        `ä¼ è¾“ä¸­: ${progress.files_transferred}/${progress.total_files} æ–‡ä»¶`;
                }

                // æ›´æ–°ä¼ è¾“é€Ÿåº¦
                if (progress.speed) {
                    document.getElementById('transferSpeed').textContent = progress.speed;
                }

                // æ›´æ–°å·²ä¼ è¾“å­—èŠ‚æ•° - ä½¿ç”¨æ ¼å¼åŒ–åçš„äººæ€§åŒ–æ˜¾ç¤º
                if (progress.bytes_transferred) {
                    document.getElementById('transferredBytes').textContent = progress.bytes_transferred;
                }

                // æ›´æ–°é¢„è®¡å‰©ä½™æ—¶é—´
                if (progress.eta) {
                    document.getElementById('eta').textContent = progress.eta;
                }

                // å¦‚æœæœ‰æ¶ˆæ¯ï¼Œä¹Ÿæ·»åŠ åˆ°æ—¥å¿—
                if (progress.message) {
                    addLog(progress.message);
                }
            }
        });

        socket.on('transfer_log', function(data) {
            if (data.transfer_id === currentTransferId) {
                addLog(data.message);
            }
        });

        socket.on('transfer_complete', function(data) {
            if (data.transfer_id === currentTransferId) {
                if (data.status === 'success') {
                    document.getElementById('transferStatus').textContent = 'ä¼ è¾“å®Œæˆ';
                    document.getElementById('progressBar').classList.remove('progress-bar-animated');
                    document.getElementById('progressBar').classList.add('bg-success');
                    addLog('âœ… ä¼ è¾“æˆåŠŸå®Œæˆ');
                } else {
                    document.getElementById('transferStatus').textContent = 'ä¼ è¾“å¤±è´¥';
                    document.getElementById('progressBar').classList.add('bg-danger');
                    addLog(`âŒ ä¼ è¾“å¤±è´¥: ${data.message}`);
                }

                setTimeout(resetTransferUI, 3000);
            }
        });

        // å¤„ç†å–æ¶ˆä¼ è¾“å“åº”
        socket.on('transfer_cancelled', function(data) {
            if (data.transfer_id === currentTransferId) {
                if (data.status === 'success') {
                    document.getElementById('transferStatus').textContent = 'ä¼ è¾“å·²å–æ¶ˆ';
                    document.getElementById('progressBar').classList.remove('progress-bar-animated');
                    document.getElementById('progressBar').classList.add('bg-warning');
                    addLog('âš ï¸ ä¼ è¾“å·²å–æ¶ˆ');
                } else {
                    addLog(`âŒ å–æ¶ˆä¼ è¾“å¤±è´¥: ${data.message}`);
                }

                setTimeout(resetTransferUI, 2000);
            }
        });

        // åˆå§‹åŒ–é¢æ¿è°ƒæ•´åŠŸèƒ½
        function initializeResizers() {
            // å‚ç›´åˆ†éš”æ¡ï¼ˆå·¦å³é¢æ¿ï¼‰
            const verticalResizer = document.getElementById('verticalResizer');
            const sourcePanel = document.getElementById('sourcePanel');
            const targetPanel = document.getElementById('targetPanel');

            let isResizing = false;

            verticalResizer.addEventListener('mousedown', function(e) {
                isResizing = true;
                document.addEventListener('mousemove', handleVerticalResize);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault();
            });

            function handleVerticalResize(e) {
                if (!isResizing) return;

                const container = verticalResizer.parentElement;
                const containerRect = container.getBoundingClientRect();
                const percentage = ((e.clientX - containerRect.left) / containerRect.width) * 100;

                if (percentage > 20 && percentage < 80) {
                    sourcePanel.style.width = percentage + '%';
                    targetPanel.style.width = (100 - percentage) + '%';
                }
            }

            // æ°´å¹³åˆ†éš”æ¡å·²ç§»é™¤

            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', handleVerticalResize);
                document.removeEventListener('mouseup', stopResize);
            }
        }

        // æ ¹æ®æœåŠ¡å™¨IPè·å–é»˜è®¤è·¯å¾„
        function getDefaultPath(serverIP) {
            const serverPaths = {
                '192.168.9.62': '/home/th',
                '192.168.9.61': '/home/th',
                '192.168.9.60': '/home/th',
                '192.168.9.57': '/home/thgd'
            };
            return serverPaths[serverIP] || '/home/th';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸš€ Webæ–‡ä»¶ä¼ è¾“ç³»ç»Ÿå·²å¯åŠ¨');

            // åˆå§‹åŒ–é¢æ¿è°ƒæ•´åŠŸèƒ½
            initializeResizers();

            // æœåŠ¡å™¨é€‰æ‹©å˜åŒ–æ—¶è‡ªåŠ¨æµè§ˆ
            document.getElementById('sourceServer').addEventListener('change', function() {
                if (this.value) {
                    // æ ¹æ®æœåŠ¡å™¨è®¾ç½®é»˜è®¤è·¯å¾„
                    const defaultPath = getDefaultPath(this.value);
                    document.getElementById('sourcePath').value = defaultPath;
                    setTimeout(browseSource, 100);
                }
            });

            document.getElementById('targetServer').addEventListener('change', function() {
                if (this.value) {
                    // æ ¹æ®æœåŠ¡å™¨è®¾ç½®é»˜è®¤è·¯å¾„
                    const defaultPath = getDefaultPath(this.value);
                    document.getElementById('targetPath').value = defaultPath;
                    setTimeout(browseTarget, 100);
                }
            });
        });
    </script>
</body>
</html>
